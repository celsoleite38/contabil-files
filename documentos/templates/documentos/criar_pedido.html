{% extends 'documentos/base.html' %}

{% block content %}
<div class="card shadow-sm mx-auto" style="max-width: 700px;">
    <div class="card-body">
        <h3>Solicitar Novo Documento</h3>
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-success w-100">Criar Pedido e Notificar Cliente</button>
        </form>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        // Quando a empresa selecionada mudar
        $("#id_empresa_destino").change(function () {
            const url = "{% url 'ajax_carregar_usuarios' %}";  
            const empresaId = $(this).val();

            if (empresaId) {
                $.ajax({
                    url: url,
                    data: {
                        'empresa_id': empresaId
                    },
                    success: function (data) {
                        let html_data = '<option value="">---------</option>';
                        data.forEach(function (usuario) {
                            html_data += `<option value="${usuario.id}">${usuario.username}</option>`;
                        });
                        // Preenche o campo de usu√°rio
                        $("#id_usuario_destinatario").html(html_data);
                    }
                });
            } else {
                $("#id_usuario_destinatario").html('<option value="">---------</option>');
            }
        });
    });
</script>
{% endblock %}